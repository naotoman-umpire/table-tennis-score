<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Table Tennis Scoreboard</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:green; display:flex; justify-content:center; align-items:flex-start; min-height:100vh;}
.overlay { background: rgba(255,255,255,0.95); border-radius:12px; padding:15px; margin:10px; width:900px; }
.tabs { display:flex; margin-bottom:10px; }
.tab { padding:10px 20px; border:1px solid #ccc; cursor:pointer; margin-right:5px; border-radius:8px 8px 0 0; background:#f0f0f0; }
.tab.active { background:#fff; border-bottom:none; font-weight:bold; }
.tab-content { border:1px solid #ccc; padding:20px; border-radius:0 8px 8px 8px; display:none; }
.tab-content.active { display:block; }
.players { display:flex; justify-content:space-around; }
.player { text-align:center; width:40%; position:relative; }
.score { font-size:10em; margin:10px; }
button { font-size:1em; margin:5px; padding:8px 16px; }
.cards { margin-top:10px; font-size:1.5em; }
.status { font-size:2em; font-weight:bold; color:orange; margin-top:10px; }
#winner { font-size:2em; margin-top:20px; text-align:center; color:green; }
#history { margin-top:20px; font-size:0.9em; background:#fff; padding:10px; border-radius:8px; max-height:150px; overflow-y:auto; }
.point-btn { font-size:1.5em; padding:12px 24px; font-weight:bold; background-color:#ffeb3b; border-radius:8px; }
#timerDisplay { font-size:3em; font-weight:bold; color:red; text-align:center; margin:10px 0; }
#timerControls { text-align:center; display:none; margin-bottom:10px; }
#timerControls button { margin:5px; }
#startScreen { display:flex; flex-direction:column; justify-content:center; align-items:center; min-height:80vh; }
#startScreen button { font-size:2em; padding:20px 40px; margin:20px; }
</style>
</head>
<body>

<div class="overlay" id="startScreen">
  <h1>SELECT FIRST SERVER</h1>
  <button onclick="selectServer('A')">PLAYER A</button>
  <button onclick="selectServer('B')">PLAYER B</button>
</div>

<div class="overlay" id="mainScreen" style="display:none;">
<h2>âšª TABLE TENNIS SCOREBOARD</h2>

<div id="timerDisplay"></div>
<div id="timerControls">
  <button onclick="startTimer()">START TIMER</button>
  <button onclick="stopTimer()">STOP TIMER</button>
  <button onclick="resetTimer()">RESET TIMER</button>
  <button onclick="clearTimerDisplay()">CLEAR TIMER</button>
</div>

<div style="text-align:center; margin:10px 0;">
  <button onclick="prepareTimer('WARM UP')">START WARM UP</button>
  <button onclick="prepareTimer('WATER BREAK')">START WATER BREAK</button>
  <button onclick="prepareTimer('TIMEOUT')">START TIMEOUT</button>
</div>

<div>
  Match Type: 
  <select id="matchType" onchange="setMatchType()">
    <option value="3">3 Games (Best of 5)</option>
    <option value="4">4 Games (Best of 7)</option>
  </select>
  &nbsp;&nbsp; First Server:
  <span id="firstServerDisplay"></span>
  <button onclick="correctServer()" style="font-size:0.9em; padding:4px 8px;">CORRECT SERVER</button>
</div>

<div class="tabs">
  <div class="tab active" onclick="showTab('scoreTab')">Score & Timeout</div>
  <div class="tab" onclick="showTab('cardsTab')">Cards</div>
</div>

<div id="scoreTab" class="tab-content active">
  <div class="players" id="court">
    <div class="player" id="playerA">
      <h2>PLAYER A <span id="serveA"></span></h2>
      <div><span id="scoreA" class="score">0</span> <span id="pointAStatus" class="status"></span></div>
      <div>Games: <span id="gamesA">0</span></div>
      <button class="point-btn" onclick="addPoint('A')">+1 POINT</button>
      <button onclick="removePoint('A')">-1 POINT</button><br>
      <button onclick="timeout('A')">TIMEOUT</button>
      <button onclick="removeCard('A','timeout')">UNDO TIMEOUT</button>
      <div class="cards" id="cardsA"></div>
    </div>

    <div class="player" id="playerB">
      <h2>PLAYER B <span id="serveB"></span></h2>
      <div><span id="scoreB" class="score">0</span> <span id="pointBStatus" class="status"></span></div>
      <div>Games: <span id="gamesB">0</span></div>
      <button class="point-btn" onclick="addPoint('B')">+1 POINT</button>
      <button onclick="removePoint('B')">-1 POINT</button><br>
      <button onclick="timeout('B')">TIMEOUT</button>
      <button onclick="removeCard('B','timeout')">UNDO TIMEOUT</button>
      <div class="cards" id="cardsB"></div>
    </div>
  </div>

  <div id="winner"></div>
  <button onclick="nextGame()">NEXT GAME</button>
  <button onclick="resetMatch()">RESET MATCH</button>
  <button onclick="undo()">UNDO LAST ACTION</button>
</div>

<div id="cardsTab" class="tab-content">
  <h3>CARD MANAGEMENT</h3>
  <div class="players">
    <div class="player">
      <h2>PLAYER A</h2>
      <button onclick="card('A','yellow')">ADD YELLOW</button>
      <button onclick="removeCard('A','yellow')">REMOVE YELLOW</button><br>
      <button onclick="card('A','red')">ADD RED</button>
      <button onclick="removeCard('A','red')">REMOVE RED</button>
    </div>
    <div class="player">
      <h2>PLAYER B</h2>
      <button onclick="card('B','yellow')">ADD YELLOW</button>
      <button onclick="removeCard('B','yellow')">REMOVE YELLOW</button><br>
      <button onclick="card('B','red')">ADD RED</button>
      <button onclick="removeCard('B','red')">REMOVE RED</button>
    </div>
  </div>
</div>

<div id="history">
  <h4>GAME HISTORY</h4>
  <ul id="historyList"></ul>
</div>
</div>

<script>
let scoreA=0,scoreB=0,gamesA=0,gamesB=0,firstServer='A',serveTurn='A',GAMES_TO_WIN=3,gameNumber=1;
let cardCount={A:{yellow:0,red:0,timeout:0},B:{yellow:0,red:0,timeout:0}};
let historyStack=[];
let timerInterval=null,timerSeconds=0,timerLabel="";

function selectServer(player){
  firstServer=player; serveTurn=firstServer;
  document.getElementById('firstServerDisplay').innerText=firstServer;
  document.getElementById('serveA').innerText=(firstServer==='A')?"ðŸ”´":""; 
  document.getElementById('serveB').innerText=(firstServer==='B')?"ðŸ”´":""; 
  document.getElementById('startScreen').style.display='none';
  document.getElementById('mainScreen').style.display='block';
}

function correctServer(){
  document.getElementById('mainScreen').style.display='none';
  document.getElementById('startScreen').style.display='flex';
}

function prepareTimer(type){ timerLabel=type; timerSeconds=(type==="WARM UP")?120:60; updateTimerDisplay(); showTimerButtons(true); clearInterval(timerInterval);}
function showTimerButtons(show){ document.getElementById('timerControls').style.display=show?'block':'none'; }
function startTimer(){ clearInterval(timerInterval); timerInterval=setInterval(()=>{ if(timerSeconds>0){ timerSeconds--; updateTimerDisplay(); } else { clearInterval(timerInterval); clearTimerDisplay(); } },1000); }
function stopTimer(){ clearInterval(timerInterval); }
function resetTimer(){ timerSeconds=(timerLabel==="WARM UP")?120:60; updateTimerDisplay(); }
function clearTimerDisplay(){ clearInterval(timerInterval); document.getElementById('timerDisplay').innerText=""; showTimerButtons(false); }
function updateTimerDisplay(){ document.getElementById('timerDisplay').innerText=`${timerLabel} ${timerSeconds}s`; }

function showTab(tabId){ document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active')); event.target.classList.add('active'); document.getElementById(tabId).classList.add('active'); }

function saveState(){ historyStack.push({scoreA,scoreB,gamesA,gamesB,cardCount:JSON.parse(JSON.stringify(cardCount))}); }
function undo(){ if(historyStack.length>0){ let last=historyStack.pop(); scoreA=last.scoreA; scoreB=last.scoreB; gamesA=last.gamesA; gamesB=last.gamesB; cardCount=last.cardCount; updateScores(); updateCards('A'); updateCards('B'); document.getElementById('gamesA').innerText=gamesA; document.getElementById('gamesB').innerText=gamesB; updatePointStatus(); } }
function addPoint(player){ saveState(); if(isGameFinished()) return; if(player==='A') scoreA++; else scoreB++; updateScores(); updateServer(); updatePointStatus(); }
function removePoint(player){ saveState(); if(player==='A' && scoreA>0) scoreA--; if(player==='B' && scoreB>0) scoreB--; updateScores(); updateServer(); updatePointStatus(); }
function updateScores(){ document.getElementById('scoreA').innerText=scoreA; document.getElementById('scoreB').innerText=scoreB; }
function isGameFinished(){ return ((scoreA>=11||scoreB>=11)&&Math.abs(scoreA-scoreB)>=2); }
function updateServer(){ let total=scoreA+scoreB; if(scoreA>=10 && scoreB>=10){ serveTurn=(total%2===0)?firstServer:(firstServer==='A'?'B':'A'); } else { serveTurn=(Math.floor(total/2)%2===0)?firstServer:(firstServer==='A'?'B':'A'); } document.getElementById('serveA').innerText=(serveTurn==='A')?"ðŸ”´":""; document.getElementById('serveB').innerText=(serveTurn==='B')?"ðŸ”´":""; }
function updatePointStatus(){ let statusA="",statusB=""; if(scoreA>=10 && scoreA>scoreB && !isGameFinished()) statusA="GAME POINT"; if(scoreB>=10 && scoreB>scoreA && !isGameFinished()) statusB="GAME POINT"; if(gamesA===GAMES_TO_WIN-1 && scoreA>=10 && !isGameFinished()) statusA="MATCH POINT"; if(gamesB===GAMES_TO_WIN-1 && scoreB>=10 && !isGameFinished()) statusB="MATCH POINT"; document.getElementById('pointAStatus').innerText=statusA; document.getElementById('pointBStatus').innerText=statusB; }
function nextGame(){ if(!isGameFinished()){ prepareTimer("WATER BREAK"); return; } saveState(); if(scoreA>scoreB) gamesA++; else gamesB++; document.getElementById('gamesA').innerText=gamesA; document.getElementById('gamesB').innerText=gamesB; let li=document.createElement('li'); li.innerText=`GAME ${gameNumber}: ${scoreA}-${scoreB}, WINNER ${scoreA>scoreB?'PLAYER A':'PLAYER B'}, FIRST SERVER ${firstServer}`; document.getElementById('historyList').appendChild(li); gameNumber++; scoreA=0; scoreB=0; firstServer=(firstServer==='A')?'B':'A'; updateScores(); updateServer(); updatePointStatus(); }

function updateCards(player){ let el=(player==='A')?document.getElementById('cardsA'):document.getElementById('cardsB'); let cards=[]; for(let i=0;i<cardCount[player].timeout;i++) cards.push("â¬œ"); for(let i=0;i<cardCount[player].yellow;i++) cards.push("ðŸŸ¨"); for(let i=0;i<cardCount[player].red;i++) cards.push("ðŸŸ¥"); el.innerText=cards.join(""); }
function card(player,type){ saveState(); if(cardCount[player][type]!==undefined){ cardCount[player][type]++; updateCards(player); } }
function removeCard(player,type){ saveState(); if(cardCount[player][type] && cardCount[player][type]>0){ cardCount[player][type]--; updateCards(player); } }
function timeout(player){ card(player,'timeout'); prepareTimer("TIMEOUT"); }

function resetMatch(){ scoreA=0; scoreB=0; gamesA=0; gamesB=0; gameNumber=1; cardCount={A:{yellow:0,red:0,timeout:0},B:{yellow:0,red:0,timeout:0}}; updateScores(); updateCards('A'); updateCards('B'); document.getElementById('gamesA').innerText=gamesA; document.getElementById('gamesB').innerText=gamesB; document.getElementById('historyList').innerHTML=""; historyStack=[]; updatePointStatus(); }
function setMatchType(){ let type=document.getElementById("matchType").value; GAMES_TO_WIN=parseInt(type); resetMatch(); }
</script>
</body>
</html>
